"use strict";var Punycode=require("punycode");var internals={};internals.rules=require("./data/rules.json").map(function(a){return{rule:a,suffix:a.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:a.charAt(0)==="*",exception:a.charAt(0)==="!"}});internals.endsWith=function(b,a){return b.indexOf(a,b.length-a.length)!==-1};internals.findRule=function(a){var b=Punycode.toASCII(a);return internals.rules.reduce(function(c,d){if(d.punySuffix===-1){d.punySuffix=Punycode.toASCII(d.suffix)}if(!internals.endsWith(b,"."+d.punySuffix)&&b!==d.punySuffix){return c}return d},null)};exports.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."};internals.validate=function(b){var a=Punycode.toASCII(b);if(a.length<1){return"DOMAIN_TOO_SHORT"}if(a.length>255){return"DOMAIN_TOO_LONG"}var e=a.split(".");var c;for(var d=0;d<e.length;++d){c=e[d];if(!c.length){return"LABEL_TOO_SHORT"}if(c.length>63){return"LABEL_TOO_LONG"}if(c.charAt(0)==="-"){return"LABEL_STARTS_WITH_DASH"}if(c.charAt(c.length-1)==="-"){return"LABEL_ENDS_WITH_DASH"}if(!/^[a-z0-9\-]+$/.test(c)){return"LABEL_INVALID_CHARS"}}};exports.parse=function(h){if(typeof h!=="string"){throw new TypeError("Domain name must be a string.")}var c=h.slice(0).toLowerCase();if(c.charAt(c.length-1)==="."){c=c.slice(0,c.length-1)}var d=internals.validate(c);if(d){return{input:h,error:{message:exports.errorCodes[d],code:d}}}var e={input:h,tld:null,sld:null,domain:null,subdomain:null,listed:false};var b=c.split(".");if(b[b.length-1]==="local"){return e}var i=function(){if(!/xn--/.test(c)){return e}if(e.domain){e.domain=Punycode.toASCII(e.domain)}if(e.subdomain){e.subdomain=Punycode.toASCII(e.subdomain)}return e};var g=internals.findRule(c);if(!g){if(b.length<2){return e}e.tld=b.pop();e.sld=b.pop();e.domain=[e.sld,e.tld].join(".");if(b.length){e.subdomain=b.pop()}return i()}e.listed=true;var f=g.suffix.split(".");var a=b.slice(0,b.length-f.length);if(g.exception){a.push(f.shift())}e.tld=f.join(".");if(!a.length){return i()}if(g.wildcard){f.unshift(a.pop());e.tld=f.join(".")}if(!a.length){return i()}e.sld=a.pop();e.domain=[e.sld,e.tld].join(".");if(a.length){e.subdomain=a.join(".")}return i()};exports.get=function(a){if(!a){return null}return exports.parse(a).domain||null};exports.isValid=function(b){var a=exports.parse(b);return Boolean(a.domain&&a.listed)};